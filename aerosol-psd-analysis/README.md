# Tandem Multi-Lognormal Fitting Tool

A Python tool for analyzing particle size distribution data from CPMA-SMPS or AAC-SMPS experiments. This tool performs multi-lognormal fitting with interactive peak selection and calculates equivalent mobility diameters for multiply charged particles.

## Features

- **Interactive Peak Selection**: Click to select maximum and minimum points for curve fitting
- **Multi-Lognormal Fitting**: Fits multiple lognormal distributions to particle size data
- **Mobility Diameter Calculation**: Computes electrical mobility and equivalent diameters for charged particles
- **Cunningham Slip Correction**: Implements slip correction factors for accurate particle sizing
- **Visualization**: Interactive plots with real-time selection feedback and fitted curve overlays

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd aerosol_psd_fitting_tool
```

2. Install required dependencies:
```bash
pip install -r requirements.txt
```

## Usage

### Basic Usage

Run the main fitting routine:
```bash
<<<<<<< HEAD
python aerosol_psd_fitting_tool.py
```

The script will:
1. Load data from the specified CSV file
2. Display each setpoint for interactive peak selection
3. Fit multi-lognormal distributions to selected peaks
4. Calculate mobility diameters for different charge states
5. Save results to a timestamped CSV file

### Interactive Selection

1. **Select Maximum Peaks**: Left-click on the peaks you want to fit
2. **Select Minimum Points**: Left-click on valleys between peaks (optional)
3. **Undo Selection**: Right-click to remove the last selected point
4. **Complete Selection**: The fitting will proceed automatically

### Data Format

The CSV file should be in the format output by the [tandem repository](https://github.com/cambustion/tandem), which is designed for tandem aerosol classifier experiments and data inversion. The file should contain columns:

- `Mp (fg)` or `Da (nm)`: Setpoint values
- `Dm (nm)2`: Mobility diameter measurements
- `Pressure (kPa)2`: Pressure measurements
- `Temperature (C)2`: Temperature measurements
- `Conc`: Particle concentration

**Note**: This tool is specifically designed to work with data generated by the tandem measurement system developed by Cambustion, The University of Alberta, and NRC Canada. The tandem repository provides automation for tandem aerosol classifier experiments and produces CSV files in the required format for this fitting tool.

## Files

- `aerosol_psd_fitting_tool.py`: Main analysis script with interactive peak selection
- `requirements.txt`: Python package dependencies

## Scientific Background

This tool implements the Cunningham slip correction factor based on:
- Kim, J. H., Mulholland, G. W., Kukuck, S. R., & Pui, D. Y. (2005)
- Rader, D. J. (1990) momentum slip correction factors

## Output

Results are saved as CSV files containing:
- Setpoint values
- Charge numbers
- Median mobility diameters
- Total particle concentrations

## Requirements

- Python 3.7+
- NumPy
- Pandas
- Matplotlib
- SciPy

## Author

Morteza Kiasadegh

## License

This project is for academic research purposes.
